{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Carrinho</title>

  <link rel="icon" href="{% static 'app_loja/favicon/carrinho-de-compras.png'%}" type="image/x-icon" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />
  <link rel="stylesheet" href="{% static 'app_loja/css/style.css' %}" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    .carrinho-container {
      display: flex;
      flex-wrap: wrap;
      gap: 2rem;
    }

    .lista-itens {
      flex: 2;
      min-width: 300px;
    }

    .resumo-carrinho {
      flex: 1;
      min-width: 250px;
      height: fit-content;
      background-color: #f8f9fa;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.08);
    }

    .card-carrinho {
      display: flex;
      align-items: center;
      padding: 15px;
      border: 1px solid #ddd;
      border-radius: 10px;
      margin-bottom: 15px;
      background-color: #fff;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }

    .card-carrinho img {
      width: 80px;
      height: 80px;
      object-fit: contain;
      margin-right: 15px;
      border-radius: 6px;
      border: 1px solid #eee;
    }

    .card-info {
      flex: 1;
    }

    .card-info h5 {
      font-size: 1rem;
      margin-bottom: 4px;
    }

    .card-info p {
      margin: 0;
      font-size: 0.9rem;
      color: #555;
    }

    .card-info form {
      margin-top: 5px;
    }

    .resumo-carrinho h4 {
      font-size: 1.2rem;
      margin-bottom: 15px;
    }

    .resumo-carrinho .btn {
      width: 100%;
    }

    @media (max-width: 768px) {
      .carrinho-container {
        flex-direction: column;
      }
    }
  </style>
</head>

<body>
  <header class="bg-light border-bottom py-3 mb-4">
    <div class="container d-flex flex-wrap justify-content-between align-items-center">
      <h1 class="logo m-0">W.S <span>ECOMMERCE</span></h1>
  </header>

  <div class="container mb-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2 class="fw-semibold">üõí Seu Carrinho de Compras</h2>
      <a href="{% url 'home_geral' %}" class="btn btn-outline-secondary">‚Üê Voltar para Loja</a>
    </div>

    {% if carrinho %}
    <div class="carrinho-container">
      <div class="lista-itens">
        {% for item in carrinho %}
        <div class="card-carrinho">
          <img src="{{ item.produto.image.url }}" alt="{{ item.produto.name }}">
          <div class="card-info">
            <h5>{{ item.produto.title }}</h5>
            <p>{{ item.quantidade }}x - R${{ item.produto.price|floatformat:2 }}</p>
            <form method="post" action="{% url 'remover_item' item.produto.id %}">
              {% csrf_token %}
              <button type="submit" class="btn btn-sm btn-outline-danger" onclick="mostrarPopup()">Remover</button>
            </form>
          </div>
        </div>
        {% endfor %}
      </div>

      <div class="resumo-carrinho">
        <h4>Resumo da Compra</h4>
        <p class="mb-2">Total: <strong>R${{ total|floatformat:2 }}</strong></p>
        <a href="{% url 'finalizar_compra' %}" class="btn btn-success mt-3">Finalizar Compra</a>
      </div>
    </div>
    {% else %}
    <p class="text-center text-muted mt-5">Seu carrinho est√° vazio.</p>
    {% endif %}
  </div>

  <script>
    function mostrarPopup() {
      Swal.fire({
        icon: 'success',
        title: 'Item removido com sucesso!',
        confirmButtonText: 'OK',
        confirmButtonColor: '#4CAF50',
        background: '#fefefe',
        color: '#333',
        showClass: {
          popup: 'animate__animated animate__fadeInDown'
        },
        hideClass: {
          popup: 'animate__animated animate__fadeOutUp'
        }
      });
    }
  </script>
</body>
</html>
